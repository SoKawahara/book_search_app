<% provide(:title , @user.name) %>
<%= render 'follow_form' if logged_in? %>
<section class="profile">
    <%= image_tag gravatar_for(@user) , class: "gravatar-img" %>
    <div class = "user-info">
        <h3 class="account-name">
            <%= @user.name %>
        </h3>
        <ul class="account-info">
            <li>
                <p>フォロー</p>
                <p><%= link_to @user.following.count , "/users/#{@user.id}/following" , id: "following" %></p>
            </li>
            <li>
                <p>フォロワー</p>
                <p><%= link_to @user.followers.count , "/users/#{@user.id}/followers" , id: "followers"  %></p>
            </li>
            <li>
                <p>投稿</p>
                <p><%= @user.what_goods.count %></p>
            </li>
            <li><%= image_tag("setting.svg" , class: "setting-icon" , style: "margin-left: 1rem") if current_user == @user %></li>
        </ul>
        <div class="user-menu">
            <%= link_to "プロフィール" , "/users/profile/#{@user.id}" , class: "account-profile" %>
            <%= link_to 'エピソード' , "/episodes/#{@user.id}"  , class: "account-profile" %>
            <% if current_user?(@user) %>
              <%= link_to "マイ本棚" , "/shelfs/1", class: "account-profile" %>
            <% end %>
        </div>
    </div>
        
        
    <ul class = "setting-container" > 
        <li><%= link_to "アカウント設定" , edit_user_path(@user) %></li>
        <li><%= link_to "ユーザ一覧" , users_path %></li>
        <li><%= link_to "タイムライン" , "/posts/feed/1" %></li>
        <li><%= link_to "ログアウト" , logout_path, data: { "turbo-method": :delete } %></li>
        <li><%= image_tag("close-btn.svg" , class: "close-icon" ) %></li>
    </ul>


    <% if !current_user.nil? && current_user.admin?  && !current_user?(@user) %>
        <%= link_to "このユーザを削除する" , user_path(@user) , class: "delete-user" , data: { "turbo-method": :delete , turbo_confirm: "本当に削除しますか?" } %>
    <% end %>
        
        
</section>
<div class = "border"></div>
<!-- ここにユーザの投稿一覧を表示する -->
<% if !@goods.empty? %>
  <!-- renderとrender partial:ではcollection , localsなどのオプションをつける際に書く必要があるのかどうかだけでさほど違いはない -->
  <!-- それ以外の違いとしてはパーシャルを明示的に指定しているのかの違い -->
  <section class="parent">
    <h1 class = "new-title">投稿一覧</h1>
    <div class="btn-group dropup">
      <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id = "view-style-btn">
        <% if @type == "1" %>
            新しい順
        <% elsif @type == "2" %>
            古い順
        <% else %>
            いいね順
        <% end %>
      </button>
      <!-- この部分はTurbo Streamを用いてページ全体のリロードを避ける -->
      <ul class="dropdown-menu" id = "view-style">
        <li><%= link_to "古い順" , "/users/#{@user.id}/turbo_stream_show/2?page=#{@page}" , data: {turbo_stream: true } , class: "dropdown-item" %></li>
        <li><%= link_to "新しい順" , "/users/#{@user.id}/turbo_stream_show/1?page=#{@page}" , data: {turbo_stream: true } , class: "dropdown-item" %></li>
        <li><%= link_to "いいね順" , "/users/#{@user.id}/turbo_stream_show/3?page=#{@page}" , data: {turbo_stream: true } , class: "dropdown-item" %></li>
      </ul>
    </div>
    <section class = "posts-container" id = "posts-container">
        <!-- ここでは_good.html.erbパーシャルファイルに対してGoodモデルで作成された@goodsコレクションを渡している -->
        <!-- goodパーシャルの中ではパーシャル名と同じgoodというインスタンス変数を通してコレクションの個別の要素にアクセスでき-->
        <%= render partial: "posts/good" , collection: @goods %>
    </section>
    <%= paginate @goods, theme: "bootstrap-5" %>
  </section>
<% else %>
  <%= render 'posts/no_good' %>
<% end %>


      

    